# Changelog Management

This directory contains changelog entries for changes made to the repository. The changelog entries are used to generate release notes when a new version is released.

## How It Works

1. When you create a PR, you should create a changelog file named `pr-{PR_NUMBER}.txt` in this directory.
2. If you don't create one, GitHub Actions will automatically create one for you.
3. The changelog file should follow the format shown in the examples below.
4. The description in the changelog entry must be 95 characters or less.
5. During the release process, all changelog files are combined to generate release notes.
6. After release, all changelog files are moved to the `archive/{version}` directory.

## Creating a Changelog Entry

You can create a changelog entry in one of two ways:

### Automatic Creation

When you create a PR, the CI pipeline will check if a changelog entry exists for your PR. If not, it will automatically create one based on your PR title. The type of change will be inferred from your PR title (e.g., "fix", "feat", etc.).

### Manual Creation

You can also create a changelog entry manually using one of these methods:

1. **Using the script**:

   ```bash
   ./scripts/create-changelog.sh <PR-NUMBER> <CHANGE-TYPE> "Your change description" [JIRA-TICKET]
   ```

   Example:

   ```bash
   ./scripts/create-changelog.sh 123 feature "Added new calculator function" CDI-456
   ```

2. **Manually creating the file**:
   Create a file named `pr-{PR_NUMBER}.txt` in the `.changelog` directory with the following format:

   ```plaintext
   <triple backticks>release-note:feature
   Your change description [JIRA-TICKET]
   <triple backticks>
   ```

   (Replace `<triple backticks>` with three backtick characters)
   
   Make sure to include the Jira ticket (CDI-## or PDI-##) at the end of your description if applicable.

## Changelog File Format

Changelog files use a specific format with sections marked by triple backticks and a section type. Each file can contain multiple sections. The recognized section types are:

- `release-note:breaking-change` - Breaking changes that require user action
- `release-note:feature` - New features
- `release-note:enhancement` - Enhancements to existing functionality
- `release-note:bug` - Bug fixes
- `release-note:note` - General notes about the release
- `release-note:security` - Security-related changes
- `release-note:deprecation` - Deprecated features or functionality

### Character Limit

The description text in each changelog entry must be 95 characters or less. This limit ensures that release notes are concise and readable. If your description exceeds this limit, you'll need to shorten it.

## Example

```release-note:feature
Added new calculator function `Multiply` that allows multiplication of two numbers. CDI-123
```

```release-note:bug
Fixed issue where division by zero would cause the application to crash instead of returning an error. PDI-456
```

## Release Process

1. During the release process, all changelog files in this directory are processed.
2. The release notes are generated by combining all changelog entries.
3. After release, the changelog files are moved to the `archive/{version}` directory.
4. This process ensures that each release contains only the changes made since the last release.

## Using the Changelog Tools

The repository includes scripts for working with changelog files:

- `scripts/create-changelog.sh` - Creates a new changelog entry for a PR

   ```bash
   ./scripts/create-changelog.sh <PR-NUMBER> <CHANGE-TYPE> "Your change description" [JIRA-TICKET]
   ```

   Example:

   ```bash
   ./scripts/create-changelog.sh 123 feature "Added new calculator function" CDI-456
   ```

   Note: Jira tickets must be in the format CDI-## or PDI-##. If not provided as an argument,  
   the script will prompt for a Jira ticket.

- `scripts/generate-release-notes.sh` - Generates two types of release notes:
  1. `GITHUB_RELEASE_NOTES.md` with the format `<commit hash link> <description> <PR# link> <Jira ticket>` for GitHub releases
  2. `release-notes/{version}/RELEASE_NOTES.adoc` with a human-readable AsciiDoc version
- `scripts/archive-changelog.sh` - Archives changelog files after a release

Run these scripts with the appropriate parameters when needed.
